// OutlandMall by Sandro & Gankstar
setvar! timeout 650
clearignore
clearsysmsg
removelist 'vendors'
createlist 'vendors'
removelist 'runetomeSpots'
createlist 'runetomeSpots'

// Add recall locations here.
// Location 100 is the first rune in the tome. 101 is the second, and so on.
pushlist 'runetomeSpots' 100
pushlist 'runetomeSpots' 101
pushlist 'runetomeSpots' 102
pushlist 'runetomeSpots' 103
pushlist 'runetomeSpots' 104
pushlist 'runetomeSpots' 105
pushlist 'runetomeSpots' 106
pushlist 'runetomeSpots' 107
pushlist 'runetomeSpots' 108
pushlist 'runetomeSpots' 109
pushlist 'runetomeSpots' 110
pushlist 'runetomeSpots' 111
pushlist 'runetomeSpots' 112
pushlist 'runetomeSpots' 113
pushlist 'runetomeSpots' 114
pushlist 'runetomeSpots' 115
pushlist 'runetomeSpots' 116
pushlist 'runetomeSpots' 117
pushlist 'runetomeSpots' 118
pushlist 'runetomeSpots' 119
pushlist 'runetomeSpots' 120
pushlist 'runetomeSpots' 121
pushlist 'runetomeSpots' 122
pushlist 'runetomeSpots' 123
pushlist 'runetomeSpots' 124
pushlist 'runetomeSpots' 125

dclick backpack
if findtype "runetome" backpack as tome
    setvar! myTome tome
else
    overhead "NO TOME" 18
    stop
endif

while not dead
    if not atlist 'runetomeSpots' 0
        sysmsg "Done!"
        stop
    elseif poplist 'runetomeSpots' front as spot
        walk "West"
        overhead 'recalling to spot {{spot}}'
        dclick myTome
        waitforgump 167090027
        gumpresponse spot 167090027
        wait 3000
    endif

    walk "North"
    walk "South"
    skill 'hiding'
    sysmsg "…OutlandMall Start" 23
    wait 2000
    say "[coords"
    wait 2000
    while not dead
        @hotkey 'Next Monster Target'
        @setvar! 'vendorID' lasttarget
        getlabel 'vendorID' 'vendorName'
        if "only]" in vendorName
            continue
        endif

        if noto 'vendorID' = invulnerable
            if inlist 'vendors' 'vendorID'
                 sysmsg "…OutlandMall End" 23
                 break
            else
                pushlist 'vendors' 'vendorID'
                sysmsg "…vendorStart {{vendorID}} {{vendorName}}" 23
            endif

            for 5
                if not hidden
                    skill 'hiding'
                    wait 11000
                else
                    break
                endif
            endfor

            if insysmsg "The world will save in"
              while not insysmsg "World save complete."
                overhead 'waiting for world save' 18
                pause 1000
              endwhile
              clearsysmsg
            endif

            if findtype 3701 'vendorID' as mainBackpack
                setvar! container mainBackpack
                setvar! searching 1
                dclick 'mainBackpack'
                wait timeout
                @ignore mainBackpack
    
                while searching = 1            
                    if findtype 2472|2473|2474|2475|2476|2480|2481|2482|2604|2605|2606|2607|2608|2609|2610|2611|2612|2613|2614|2615|2616|2617|2618|2619|2620|2621|2622|2623|2624|2625|2626|2627|2628|2629|2630|2631|2632|2633|2634|2635|2636|2637|2638|2639|2640|2641|2642|2643|2711|2712|2713|2714|2715|2716|2717|2718|3644|3645|3646|3647|3648|3649|3650|3651|3701|3702|3703|3704|3705|3706|3708|3709|3710|3711|3712|7808|7809|9002|9003|11010|11011|12657|29833 mainBackpack as subContainer
                        @ignore subContainer
                        setvar! container subContainer
                        getlabel subContainer desc
                        if "Price: Not for sale" in desc
                            dclick subContainer
                            wait timeout
                        elseif "Description: " in desc
                            //sysmsg "…bag {{desc}}" 23
                        elseif "paragon" in desc
                            sysmsg "…item {{desc}}" 23
                        endif
                    else
                        setvar! searching 0
                        setvar! container mainBackpack
                    endif
                    while findtype 19253|19252|19251|19250|19248|19246|19249|19247|29774|29773|28881|28885|28883|28879|28880|19254|19232|19228|29382|19233|7127|19239|19227|7154|19236|19237|4225|19234|19235|5356|8826|3985|3836|17686|45285|48261|576|24345|22336|42519|12686|39517|5981|6238|11886|11887|11888|11881|11890|11891|11884|11885|11883|11889|11882|8787|8786|24246|16898|29040|43206|3712|3650|3708|3648|2475|3651|29833|19199|15178|6464|5359|3843|3842|29036|15297|29025|3838|15296|30580|2594|22433|22326|48357|48358|48359|48360|48361|48362|48363|48364|48365|48366|48367|48368|48369|48370|48371|48372|48373|48374|48375|48376|48377|48378|48379|48380|48381|48382|48383|48384|48385|48386|48387|48388|48389|48391|48392|48393|48394|48395|48396|48397|48398|48399|48400|48401|48402|48403|48404|48405|48406|48407|12686|4248|4249|4250|4251|4252|4253|4254|4255|4256|4257|4258|4259|43159|43160|43161|43162|43163|43164|43165|43166|43167|43168|43169|43170|43171|43172|43173|5188|3699|3530|9917|3520|3657|5362|5370|5365|2463|25758|8455|8454|5363|3908|11552|3718|5373|3897|3715|20502|20499|6187|11942|19403|29345|29343|6193|7732|2323|29030|30765|12215|50675|17087|23997|23996|24434|3736|3737|3735|3738|18283|29354|11762|41459|23034|51100|22197|25750|52149|5370|42564|44328|20495|20496|29001|8012|8901|29103|29105|42516|42517|17083|2594|5360|3591|7866|51094|21939|3763|3762|10245|3742|3740|3834|5117|3920|5042|3713|5127|3721|5044|5179|5177|5125|3938|5121|3719|5123|3917|5049|5182|5115|3915|3909|5119|3937|5040|5187|22187|7029|7031|7035|7026|7027|7033|7109|7107|5075|5074|5061|5070|7610|5063|7177|7175|7169|7179|5090|5089|5076|5085|5078|7170|7181|5204|5207|5203|5205|5201|7177|5101|5105|5103|5106|5131|5060|5059|5103|5056|5142|5146|5143|5144|5139|7173|5132|5138|5129|22288|22293|21862|21849|21799|22167|22289|22426|21924|30589|21843|22419|21883|21873|22184|22163|21889|21933|30629|22178|21867|21789|30596|22177|30643|22173|30660|30579|21807|30658|30608|30610|30631|30611|21830|22164|21836|22434|30602|30641|21921|21880|21824|30638|30769|21787|21909|21997|30613|21935|30771|21827|30655|21996|30767|30568|30652|30573|30768|22174|30634|21800|22437|21818|22157|22296|21944|22154|30622|30630|30662|22153|21942|30588|30653|22291|30603|22188|30586|22443|21876|22435|30626|21956|21864|21908|21926|22438|21804|22152|21906|21948|30778|30562|30617|21859|21945|21907|30651|21949|21953|21957|30565|21809|21947|22172|21803|30583|21805|21891|30590|21999|22294|30659|22169|30601|21868|21886|21835|22436|30561|21963|21960|21927|21905|30773|22295|21962|22158|21904|21790|21801|21801|30649|30578|30646|22290|22427|21806|21881|22439|21826|21841|21828|21848|21938|21969|21964|30604|21911|22440|21879|21934|21918|22287|21845|30587|21917|30640|21853|30563|22185|30567|21998|21870|22155|22444|21798|30564|21882|21829|21856|30566|21838|30647|21929|21788|30609|30632|30592|21872|22418|21875|21951|22421|22445|21831|22151|21810|22166|22423|21852|21786|21981|21943|21954|21897|22186|22165|30775|30618|30776|30575|21842|30636|21923|30648|30574|21866|21785|22170|30639|22261|30637|21895|22285|21896|30661|30645|21950|30625|21808|22286|21814|22422|30623|22431|21840|21878|21783|30772|21865|22168|22272|22181|21877|21871|21797|21902|30766|21925|21899|30582|21894|22442|22430|21885|22417|30621|21791|21784|21874|21863|30628|21860|21898|21884|21931|22264|21936|21978|22180|30635|21847|22183|30576|30615|21901|22182|21940|22175|21893|30770|21937|21844|30591|22428|22429|30657|30599|30644|22179|22292|30614|30633|30624|30612|21861|22420|30642|30650|30577|21780|22441|30627|21781|51098|22455|22456|22453|22297|22298|22199|21988|30663|22451|22449|3827|23034|3859|3877|3862|3878|3865|3873|3856|30609|30825|30611|30614|30819|30826|30613|30821|30615|30827|30828|30818|30612|30823|30822|30829|51450|51551|51452|51453|51454|51455|51456|51457|51458|51459|29833|2594|2595|2596|2597
|3999|3368|3372|3366|3370|19370|3256|3257|19512|3255|3258|19513|13310|13299|13297|3392|13292|3391|13291|3219|26669|26670|19520|19524|3268|21399|21398|3332|26701|3259|26671|26672|3346|3341|3344|3348|3342|3340|3345|3343|13335|13336|13312|13311|3239|13290|3271|13298|13316|3367|3203|3207|3223|39351|39350|39353|39352|29502|3204|3211|3231|3232|19508|3237|19521|29497|29498|13308|13309|19372|13319|3206|3262|3263|13320|3214|13307|13321|3220|3347|26664|3238|39264|3224|3234|3235|3233|26693|13278|3365|13313|13314|3374|26724|26721|26719|26720|19522|13318|13328|3313|3309|3308|3312|3307|3311|13301|13300|26732|13330|26700|28924|3314|3310|27564|27565|27562|27561|27563|12321|12324|12323|12322|12320|3305|3306|39343|39347|3377|3376|14544|39346|39345|20377|20379|20376|20378|26688|26689|27580|27577|27584|3217|3215|39349|39348|3272|3226|3227|3229|3228|3225|3241|21397|21402|21400|21405|21404|21403|21401|3273|20466|20467|39344|3243|19532|20385|20381|20383|20384|8752|8753|8751|8750|3496|3492|14594|20391|20392|26737|26734|3230|3383|28908|28910|28909|14530|14522|14456| container as foundItem
                        getlabel 'foundItem' desc
                        sysmsg "…item {{desc}}" 23
                        @ignore foundItem
                    endwhile
                endwhile
                wait 1200
                sysmsg "…vendorEnd {{vendorID}} {{vendorName}}" 23
                walk "North"
                walk "South"
                wait 1200
            endif
        endif
    endwhile
endwhile