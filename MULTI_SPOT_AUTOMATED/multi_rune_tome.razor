// OutlandMall by Sandro & Gankstar
setvar! timeout 650
@clearignore
clearsysmsg
removelist 'vendors'
createlist 'vendors'
removelist "runetomeSpots"
createlist "runetomeSpots"

// Add recall locations here.
// Location 100 is the first rune in the tome. 101 is the second, and so on.
pushlist 'runetomeSpots' 100
pushlist 'runetomeSpots' 101
pushlist 'runetomeSpots' 102
pushlist 'runetomeSpots' 103
pushlist 'runetomeSpots' 104
pushlist 'runetomeSpots' 105
pushlist 'runetomeSpots' 106
pushlist 'runetomeSpots' 107
pushlist 'runetomeSpots' 108
pushlist 'runetomeSpots' 109
pushlist 'runetomeSpots' 110
pushlist 'runetomeSpots' 111
pushlist 'runetomeSpots' 112
pushlist 'runetomeSpots' 113
pushlist 'runetomeSpots' 114
pushlist 'runetomeSpots' 115
pushlist 'runetomeSpots' 116
pushlist 'runetomeSpots' 117
pushlist 'runetomeSpots' 118
pushlist 'runetomeSpots' 119
pushlist 'runetomeSpots' 120
pushlist 'runetomeSpots' 121
pushlist 'runetomeSpots' 122
pushlist 'runetomeSpots' 123
pushlist 'runetomeSpots' 124
pushlist 'runetomeSpots' 125

// CONVERT THE ID OF YOUR RUNE TOME USING  https://www.rapidtables.com/convert/number/hex-to-decimal.html
// REPLACE THE NUMBERS BELOW WITH YOUR RUNE TOME HEX CODE, EACH BLOCK STANDS FOR 1 RUNE TOME
// COMMENT OUT THE RUNE TOMES U DONT NEED (CURRENT SETUP USES 4 TOMES)
// THIS SCRIPT WORKS WITH 3 CLIENTS IN PARALLEL

if not listexists "OutlandMallsRuneTomes"
    createlist "OutlandMallsRuneTomes"
endif
// RUNE TOME 1
if not inlist "OutlandMallsRuneTomes" 1439680668
    sysmsg "adding 1 to list" 55
    pushlist "OutlandMallsRuneTomes" 1439680668
endif
// RUNE TOME 2
if not inlist "OutlandMallsRuneTomes" 1185712905
    sysmsg "adding 2 to list" 55
    pushlist "OutlandMallsRuneTomes" 1185712905
endif
// RUNE TOME 3
if not inlist "OutlandMallsRuneTomes" 1392448283
    sysmsg "adding 3 to list" 55
    pushlist "OutlandMallsRuneTomes" 1392448283
endif
// RUNE TOME 4
if not inlist "OutlandMallsRuneTomes" 1439679560
    sysmsg "adding 4 to list" 55
    pushlist "OutlandMallsRuneTomes" 1439679560
endif

dclick backpack
if not findtype 'runetome' backpack
    overhead 'NO TOME' 19
    stop
endif

@setvar! myTome 0
while myTome = 0
    if poplist "OutlandMallsRuneTomes" front as tome
        pushlist "OutlandMallsRuneTomes" tome back
        if find tome backpack
            @unsetvar! myTome
            @setvar! myTome tome
            getlabel tome tomeName
            sysmsg "Using tome {{tomeName}} {{tome}}" 55
        endif
    else
        overhead "LIST EMPTY" 19
        stop
    endif
endwhile

wait 60000

// IF YOU USE A STORAGE SHELF TO RESTOCK UNCOMMENT
//if findtype "storage shelf" ground -1 -1 2 as shelf
//    menu shelf 1
//    wait 500
//    if findtype 8012 backpack as scrolls
//      wait 1000
//      lift scrolls 50
//      wait 1000
//      drop myTome
//      wait 1000
//      if findtype 8012 backpack as scrolls
//        lift scrolls 50
//        wait 1000
//        drop shelf
//      endif
//    endif
//    overhead 'resupply done'
//else
//    overhead 'no shelf'
//endif

// IF YOU USE A CHEST TO RESTOCK UNCOMMENT
// if findtype "ph chest" ground -1 -1 2 as chest
//    dclick chest
//    wait timeout
//    if findtype 8012 chest as scrolls
//        sysmsg "lifting scrolls" 55
//        lift scrolls 50
//        drop backpack
//        wait timeout
//        lift scrolls 50
//        drop myTome
//        sysmsg "dropping scrolls on runebook" 55
//        wait timeout
//        if findtype 8012 backpack as scrolls
//            lift scrolls 50
//            drop chest
//            wait timeout
//        endif
//    endif
// endif

while not dead
    if not atlist 'runetomeSpots' 0
        skill 'hiding'
        wait 120000
        say '[atlas'
    stop
    elseif poplist 'runetomeSpots' front as spot
        walk "West"
        sysmsg 'recalling to spot {{spot}} in {{myTome}}' 55
        wait 1000
        dclick myTome
        waitforgump 167090027
        gumpresponse spot 167090027
        wait 3000
    endif

    walk "North"
    walk "South"
    skill 'hiding'
    sysmsg "…OutlandMall Start" 23
    wait 2000
    say "[coords"
    wait 2000
    while not dead
        @hotkey 'Next Monster Target'
        @setvar! 'vendorID' lasttarget
        getlabel 'vendorID' 'vendorName'
        if "only]" in vendorName
            continue
        endif
        if noto 'vendorID' = invulnerable
            if inlist 'vendors' 'vendorID'
                 sysmsg "…OutlandMall End" 23
                 break
            else
                pushlist 'vendors' 'vendorID'
                sysmsg "…vendorStart {{vendorID}} {{vendorName}}" 23
            endif

            for 5
                if not hidden
                    skill 'hiding'
                    wait 11000
                else
                    break
                endif
            endfor

            if insysmsg "The world will save in"
              while not insysmsg "World save complete."
                overhead 'waiting for world save' 18
                pause 1000
              endwhile
              clearsysmsg
            endif

            if findtype 3701 'vendorID' as mainBackpack
                setvar! container mainBackpack
                setvar! searching 1
                dclick 'mainBackpack'
                wait timeout
                @ignore mainBackpack

                while searching = 1
                    if findtype 2472|2473|2474|2475|2476|2480|2481|2482|2604|2605|2606|2607|2608|2609|2610|2611|2612|2613|2614|2615|2616|2617|2618|2619|2620|2621|2622|2623|2624|2625|2626|2627|2628|2629|2630|2631|2632|2633|2634|2635|2636|2637|2638|2639|2640|2641|2642|2643|2711|2712|2713|2714|2715|2716|2717|2718|3644|3645|3646|3647|3648|3649|3650|3651|3701|3702|3703|3704|3705|3706|3708|3709|3710|3711|3712|7808|7809|9002|9003|11010|11011|12657|29832|29833 mainBackpack as subContainer
                        @ignore subContainer
                        setvar! container subContainer
                        getlabel subContainer desc
                        if "Price: Not for sale" in desc
                            dclick subContainer
                            wait timeout
                        elseif "Description: " in desc
                            //sysmsg "…bag {{desc}}" 23
                        elseif "paragon" in desc
                            sysmsg "…item {{desc}}" 23
                        endif
                    else
                        setvar! searching 0
                        setvar! container mainBackpack
                    endif
                    while findtype 19253|19252|19251|19250|19248|19246|19249|19247|29774|29773|28881|28885|28883|28879|28880|19254|19232|19228|29382|19233|7127|19239|19227|7154|19236|19237|4225|19234|19235|5356|8826|3985|3836|17686|45285|48261|576|24345|22336|42519|12686|39517|5981|6238|11886|11887|11888|11881|11890|11891|11884|11885|11883|11889|11882|8787|8786|24246|16898|29040|43206|3712|3650|3708|3648|2475|3651|29833|19199|15178|6464|5359|3843|3842|29036|15297|29025|3838|15296|30580|2594|22433|22326|48357|48358|48359|48360|48361|48362|48363|48364|48365|48366|48367|48368|48369|48370|48371|48372|48373|48374|48375|48376|48377|48378|48379|48380|48381|48382|48383|48384|48385|48386|48387|48388|48389|48391|48392|48393|48394|48395|48396|48397|48398|48399|48400|48401|48402|48403|48404|48405|48406|48407|12686|4248|4249|4250|4251|4252|4253|4254|4255|4256|4257|4258|4259|43159|43160|43161|43162|43163|43164|43165|43166|43167|43168|43169|43170|43171|43172|43173|5188|3699|3530|9917|3520|3657|5362|5370|5365|2463|25758|8455|8454|5363|3908|11552|3718|5373|3897|3715|20502|20499|6187|11942|19403|29345|29343|6193|7732|2323|29030|30765|12215|50675|17087|23997|23996|24434|3736|3737|3735|3738|18283|29354|11762|41459|23034|51100|22197|25750|52149|5370|42564|44328|20495|20496|29001|8012|8901|29103|29105|42516|42517|17083|2594|5360|3591|7866|51094|21939|3763|3762|10245|3742|3740|3834|5117|3920|5042|3713|5127|3721|5044|5179|5177|5125|3938|5121|3719|5123|3917|5049|5182|5115|3915|3909|5119|3937|5040|5187|22187|7029|7031|7035|7026|7027|7033|7109|7107|5075|5074|5061|5070|7610|5063|7177|7175|7169|7179|5090|5089|5076|5085|5078|7170|7181|5204|5207|5203|5205|5201|7177|5101|5105|5103|5106|5131|5060|5059|5103|5056|5142|5146|5143|5144|5139|7173|5132|5138|5129|22288|22293|21862|21849|21799|22167|22289|22426|21924|30589|21843|22419|21883|21873|22184|22163|21889|21933|30629|22178|21867|21789|30596|22177|30643|22173|30660|30579|21807|30658|30608|30610|30631|30611|21830|22164|21836|22434|30602|30641|21921|21880|21824|30638|30769|21787|21909|21997|30613|21935|30771|21827|30655|21996|30767|30568|30652|30573|30768|22174|30634|21800|22437|21818|22157|22296|21944|22154|30622|30630|30662|22153|21942|30588|30653|22291|30603|22188|30586|22443|21876|22435|30626|21956|21864|21908|21926|22438|21804|22152|21906|21948|30778|30562|30617|21859|21945|21907|30651|21949|21953|21957|30565|21809|21947|22172|21803|30583|21805|21891|30590|21999|22294|30659|22169|30601|21868|21886|21835|22436|30561|21963|21960|21927|21905|30773|22295|21962|22158|21904|21790|21801|21801|30649|30578|30646|22290|22427|21806|21881|22439|21826|21841|21828|21848|21938|21969|21964|30604|21911|22440|21879|21934|21918|22287|21845|30587|21917|30640|21853|30563|22185|30567|21998|21870|22155|22444|21798|30564|21882|21829|21856|30566|21838|30647|21929|21788|30609|30632|30592|21872|22418|21875|21951|22421|22445|21831|22151|21810|22166|22423|21852|21786|21981|21943|21954|21897|22186|22165|30775|30618|30776|30575|21842|30636|21923|30648|30574|21866|21785|22170|30639|22261|30637|21895|22285|21896|30661|30645|21950|30625|21808|22286|21814|22422|30623|22431|21840|21878|21783|30772|21865|22168|22272|22181|21877|21871|21797|21902|30766|21925|21899|30582|21894|22442|22430|21885|22417|30621|21791|21784|21874|21863|30628|21860|21898|21884|21931|22264|21936|21978|22180|30635|21847|22183|30576|30615|21901|22182|21940|22175|21893|30770|21937|21844|30591|22428|22429|30657|30599|30644|22179|22292|30614|30633|30624|30612|21861|22420|30642|30650|30577|21780|22441|30627|21781|51098|22455|22456|22453|22297|22298|22199|21988|30663|22451|22449|3827|23034|3859|3877|3862|3878|3865|3873|3856|30609|30825|30611|30614|30819|30826|30613|30821|30615|30827|30828|30818|30612|30823|30822|30829|51450|51451|51452|51453|51454|51455|51456|51457|51458|51459|29833|2594|2595|2596|2597|3999|3368|3372|3366|3370|19370|3256|3257|19512|3255|3258|19513|13310|13299|13297|3392|13292|3391|13291|3219|26669|26670|19520|19524|3268|21399|21398|3332|26701|3259|26671|26672|3346|3341|3344|3348|3342|3340|3345|3343|13335|13336|13312|13311|3239|13290|3271|13298|13316|3367|3203|3207|3223|39351|39350|39353|39352|29502|3204|3211|3231|3232|19508|3237|19521|29497|29498|13308|13309|19372|13319|3206|3262|3263|13320|3214|13307|13321|3220|3347|26664|3238|39264|3224|3234|3235|3233|26693|13278|3365|13313|13314|3374|26724|26721|26719|26720|19522|13318|13328|3313|3309|3308|3312|3307|3311|13301|13300|26732|13330|26700|28924|3314|3310|27564|27565|27562|27561|27563|12321|12324|12323|12322|12320|3305|3306|39343|39347|3377|3376|14544|39346|39345|20377|20379|20376|20378|26688|26689|27580|27577|27584|3217|3215|39349|39348|3272|3226|3227|3229|3228|3225|3241|21397|21402|21400|21405|21404|21403|21401|3273|20466|20467|39344|3243|19532|20385|20381|20383|20384|8752|8753|8751|8750|3496|3492|14594|20391|20392|26737|26734|3230|3383|28908|28910|28909|14530|14522|14456|29832|51400|51401|51402|51403|51404|51405|51406|51407|51408|51409|51410|51411|51412|51413|51414|51415|51416|51417|51418|51419|51420|51421|51422|51423|51424|51425|51426|51427|51428|51429|51430|51431|51432|51433|51434|51435|51436|51437|51438|51439|51440|51441|51442|51443|51444|51445|51446|51447|51448|51449|51450|51451|51452|51453|51454|51455|51456|51457|51458|51459|51460|51461|51462|51463|51464|51465|51466|51467|51468|51469|30621|30859|30617|30854|30618|30860|30622|30852|30622|30858|30855|30853|30857|30851|30856|30852|30850|8484|8479|8480|8481|8438|8417|8478|43320|8503|8502|8501|20374|3240|18218|3221|51200|51201|51202|51203|51204|51205|51206|51207|51208|51209|51210|51211|51212|51213|51214|51215|51216|51217|51218|51219|51220|51221|51222|51223|51224|51225|51226|51227|51228|51229|51230|51231|51232|51233|51234|51235|51236|51237|51238|51239|51240|51241|51242|51243|51244|51245|51246|51247|51248|51249|51250|51251|51252|51253|51254|51255|51256|51257|51258|51259|51260|51261|51262|51263|51264|51265|51266|51267|51268|51269|51270|51271|51272|51273|51274|51275|51276|51277|51278|51279|51280|51281|51282|51283|51284|51285|51286|51287|51288|51289|51290|51291|51292|51293|51294|51295|51296|51297|51298|51299|51300|51301|51302|51303|51304|51305|51306|51307|51308|51309|51310|51311|51312|51313|51314|51315|51316|51317|51318|51319|51320|51321|51322|51323|51324|51325|51326|51327|51328|51329|51330|51331|51332|51333|51334|51335|51336|51337|51338|51339|51340|51341|51342|51343|51344|51345|51346|51347|51348|51349|51350|51351|51352|51353|51354|51355|51356|51357|51358|51359|51360|51361|51362|51363|51364|51365|51366|51367|51368|51369|51370|51371|51372|51373|51374|51375|51376|51377|51378|51379|51380|51381|51382|51383|51384|51385|51386|51387|51388|51389|51390|51391|51392|51393|51394|51395|51396|51397|51398|51399|28765|28799|28775|45250|45246|45281|45254|45255|45238|45248|45218|28795|45251|45241|45222|45211|45216|45235|45236|45239|45252|45220|45214|45255|45208|28760|28803|45282|45247|28768|42242|45242|24380|24381|24382|24383|24384|24385|24386|24387|24388|24389|24390|24391|24392|24393|24394|24395|24396|24397|24398|24399|24400|24401|24402|24403|24404|24405|24406|24407|24408|24409|24410|24411|24412|24413|24414|24415|24416|24417|24418|24419|24420|24421|24422|24423|24424|24425|24426|24427|24428|24429|24430|24431|24432|24433|24434|24435|24436|24437|24438|24439|24440|5418|43277|15577|15635|44310|15638|42227|42665|15580|43279|10527|10827|5421|42574|41510|44986|18652|47107|18704|18658|18400|47111|44800|44804|12282|44796|44801|44799|44797|44795|29463|45193|44810|44798|29142|28994|28995|29352|44314|45828|45002|29350|29431|45182|44312|45830|7116|29430|45120|29428|25647|24197|24191|4201|23774|24193|29425|24179|24181|23009|24175|24188|4277|24199|50308|50298|24184|42240|27640|27642|45300|45400|45409|45382|45414|45373|45387|45381|45410|42244|20375|20392|29495|3222|14458|14542|3527|3288|14454|14444|14562|14574|3320|14568|49836|36752|5899|5901|5903|5905 container as foundItem
                        getlabel 'foundItem' desc
                        sysmsg "…item {{desc}}" 23
                        @ignore foundItem
                    endwhile
                endwhile
                sysmsg "…vendorEnd {{vendorID}} {{vendorName}}" 23
                walk "North"
                walk "South"
                wait 1200
            endif
        endif
    endwhile
endwhile